
<!doctype html>
<html lang="hu">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

	<title>Kaputelefon</title>

	<link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/sticky-footer-navbar/">

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>

	<style>
/* Sticky footer styles
-------------------------------------------------- */
html {
  position: relative;
  min-height: 100%;
}
body {
  /* Margin bottom by footer height */
  margin-bottom: 60px;
}
.footer {
  position: absolute;
  bottom: 0;
  width: 100%;
  /* Set the fixed height of the footer here */
  height: 60px;
  line-height: 60px; /* Vertically center the text there */
  background-color: #f5f5f5;
}


/* Custom page CSS
-------------------------------------------------- */
/* Not required for template or sticky footer method. */

body > .container {
  padding: 60px 15px 0;
}

.footer > .container {
  padding-right: 15px;
  padding-left: 15px;
}

code {
  font-size: 80%;
}

.hidden {
    display: none;
}

#urlText {
    width: 300;
}
	</style>
</head>

<body>

<header>
	<nav class="navbar navbar-expand-lg navbar-dark fixed-top bg-primary">
		<div class="container-fluid">
			<a class="navbar-brand" href="#">Kaputelefon</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarColor02">
				<ul class="navbar-nav me-auto mb-2 mb-lg-0">
					<li class="nav-item">
						<a class="nav-link" href="#settings" onclick="menu(this)">Beállítások</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#phonebook" onclick="menu(this)">Telefonkönyv</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#admin" onclick="menu(this)">Szervíz</a>
					</li>
				</ul>
				<div class="d-flex">
					<input class="form-control" placeholder="Url" id="urlText" value="http://localhost:8080">
				</div>
			</div>
		</div>
	</nav>
</header>

<!-- Begin page content -->
<main role="main" class="container">

	<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
		<div id="liveToast" class="toast align-items-center hide" role="alert" aria-live="assertive" aria-atomic="true">
			<div class="toast-header text-white bg-primary">
				<strong class="me-auto">Info</strong>
				<button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
			</div>
			<div class="toast-body" id="alertText">
			</div>
		</div>
	</div>

	<div class="page hidden" id="admin">
		<div class="mb-3">
			<button type="button" class="btn btn-primary" onclick="restart()">Újraindítás</button>
			<button type="button" class="btn btn-primary" onclick="factoryReset()">Gyári beállítások visszaállítása</button>
		</div>
	</div>
	<div class="page hidden" id="phonebook"></div>
	<div class="page hidden" id="settings">
		<div class="accordion" id="accordionExample">
			<div class="accordion-item">
				<h2 class="accordion-header" id="headingOne">
					<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
						Wifi beállítások
					</button>
				</h2>
				<div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
					<div class="accordion-body">
						<div class="card">
							<div class="card-body">
								<form action="/api/wifi_settings">
									<div class="mb-3">
										<label for="ssidText">SSID</label>
										<input name="ssid" type="text" class="form-control" id="ssidText" placeholder="SSID">
									</div>
									<div class="mb-3">
										<label for="passwordText">Jelszó</label>
										<input name="password" type="text" class="form-control" id="passwordText" placeholder="Jelszó">
									</div>
									<button type="submit" class="btn btn-primary">Mentés</button>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="accordion-item">
				<h2 class="accordion-header" id="headingTwo">
					<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
						SIP beállítások
					</button>
				</h2>
				<div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
					<div class="accordion-body">To be continued...</div>
				</div>
				</div>
			</div>
			<div class="accordion-item">
				<h2 class="accordion-header" id="headingThree">
					<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
						Kapu beállítások
					</button>
				</h2>
				<div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
					<div class="accordion-body">
						<div class="card">
							<div class="card-body">
								<form action="/api/gate">
									<div class="mb-3">
										<label for="gvolText">Csengetés hangerő</label>
										<input name="gvol" type="text" class="form-control" id="gvolText" placeholder="Csengetés hangerő">
									</div>
									<div class="mb-3">
										<label for="rvolText">Ajtócsengő hangerő</label>
										<input name="rvol" type="text" class="form-control" id="rvolText" placeholder="Ajtócsengő hangerő">
									</div>
									<div class="mb-3">
										<label for="cvolText">Beep hangerő</label>
										<input name="cvol" type="text" class="form-control" id="cvolText" placeholder="Beep hangerő">
									</div>
									<div class="mb-3">
										<label for="typeSelect">Kaputelefon típusa</label>
										<select name="type" class="form-select" id="typeSelect">
											<option selected>Válasszon...</option>
											<option value="codefon">Codefon</option>
											<option value="mkt">MKT</option>
											<option value="laskomex">Laskomex</option>
										</select>
									</div>
									<div class="mb-3">
										<label for="codeText">Kapukód</label>
										<input name="code" type="text" class="form-control" id="codeText" placeholder="Kapukód">
									</div>
									<button type="submit" class="btn btn-primary">Mentés</button>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</main>

<footer class="footer">
	<div class="container">
		<span class="text-muted">Motyo design :)</span>
	</div>
</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script
		src="https://code.jquery.com/jquery-3.6.0.min.js"
		integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
		crossorigin="anonymous"></script>
<script>
url = document.location.href;

$( document ).ready(function () {
    $('#urlText').on('change', function() {
        url = $( this ).val();
    });

    $('form').each(function() {
    	loadForm($(this));
    	$(this).submit(saveForm);
    });

    $('#urlText').val(url);
});

function showAlert(msg) {
	$('#alertText').html(msg);
	var toast = new bootstrap.Toast(document.getElementById('liveToast'));
	toast.show();
}

function loadForm(form) {
	action = form.attr('action');
	if (action != null) {
	    $.ajax({
			url: url + action,
			type: 'GET',
			success: function(data) {
				form.jsonToForm(data);
			},
			error: function(result) {
				showAlert('error');
			}
		});
	}
}

function saveForm(event) {
	event.preventDefault();
	form = event.target;
	action = form.getAttribute('action');
	if (action != null) {
	    $.ajax({
			url: url + action,
			type: 'PUT',
			contentType: "application/json",
			data: JSON.stringify(Object.fromEntries(new FormData(event.target).entries())),
			success: function(result) {
				showAlert(result);
			},
			error: function(result) {
				showAlert('error');
			}
		});
	}
}

function menu(l) {
    page = l.getAttribute('href');
    $('.page').each(function() {
        e = $( this );
        if(page != '#' + e.attr('id')) {
            e.addClass( 'hidden' );
        } else {
            e.removeClass( 'hidden' );
        }
    });
}

function restart() {
    $.ajax({
        url: url + '/api/restart',
        type: 'GET',
        success: function(result) {
            showAlert(result);
        },
        error: function(result) {
            showAlert('error');
        }
    });
}

function factoryReset() {
    $.ajax({
        url: url + '/api/factory_reset',
        type: 'GET',
        success: function(result) {
            showAlert(result);
        },
        error: function(result) {
            showAlert('error');
        }
    });
}

</script>

<script>
$.fn.jsonToForm=function(a,c){var l=this,n={data:a||null,callbacks:c};null!=n.data&&$.each(n.data,function(a,c){var e=$('[name^="'+a+'"]',l);null!=n.callbacks&&n.callbacks.hasOwnProperty(a)?n.callbacks[a](c):$(e).each(function(n,e){Array.isArray(c)?c.forEach(function(a){$(e).is("select")?$(e).find("[value='"+a+"']").prop("selected",!0):$(e).val()==a&&$(e).prop("checked",!0)}):$(e).is(":checkbox")||$(e).is(":radio")?$(e).val()==c&&$(e).prop("checked",!0):$('[name="'+a+'"]',l).val(c)})})};
</script>
</body>
</html>
